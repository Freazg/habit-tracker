# Структура бази даних Habit Tracker

Автор: Сас Євгеній
Група: ІО-31
Дата: 29 листопада 2025

## ER діаграма

```
┌─────────────────────────────────────────────┐
│                  users                      │
├─────────────────────────────────────────────┤
│ PK │ id           │ UUID                    │
│    │ email        │ VARCHAR(255) UNIQUE     │
│    │ password     │ VARCHAR(255)            │
│    │ name         │ VARCHAR(100)            │
│    │ timezone     │ VARCHAR(50)             │
│    │ created_at   │ TIMESTAMP               │
│    │ updated_at   │ TIMESTAMP               │
└─────────────────────────────────────────────┘
                      │
                      │ 1
                      │
                      │ has many
                      │
                      ▼ N
┌─────────────────────────────────────────────┐
│                 habits                      │
├─────────────────────────────────────────────┤
│ PK │ id           │ UUID                    │
│ FK │ user_id      │ UUID                    │
│ FK │ category_id  │ UUID (nullable)         │
│    │ title        │ VARCHAR(200)            │
│    │ description  │ TEXT (nullable)         │
│    │ frequency    │ ENUM (daily/weekly)     │
│    │ target_days  │ JSON (nullable)         │
│    │ is_active    │ BOOLEAN                 │
│    │ created_at   │ TIMESTAMP               │
│    │ updated_at   │ TIMESTAMP               │
└─────────────────────────────────────────────┘
                      │
                      │ 1
                      │
                      │ has many
                      │
                      ▼ N
┌─────────────────────────────────────────────┐
│               habit_logs                    │
├─────────────────────────────────────────────┤
│ PK │ id           │ UUID                    │
│ FK │ habit_id     │ UUID                    │
│    │ date         │ DATE                    │
│    │ completed    │ BOOLEAN                 │
│    │ note         │ TEXT (nullable)         │
│    │ created_at   │ TIMESTAMP               │
└─────────────────────────────────────────────┘


┌─────────────────────────────────────────────┐
│               categories                    │
├─────────────────────────────────────────────┤
│ PK │ id           │ UUID                    │
│    │ name         │ VARCHAR(100) UNIQUE     │
│    │ color        │ VARCHAR(7)              │
│    │ icon         │ VARCHAR(50) (nullable)  │
│    │ created_at   │ TIMESTAMP               │
└─────────────────────────────────────────────┘
                      │
                      │ 1
                      │
                      │ belongs to
                      │
                      ▼ N
                  (habits)
```

## Опис таблиць

### users

Таблиця користувачів системи. Містить основну інформацію для аутентифікації та налаштувань профілю. Поле password зберігає bcrypt хеш паролю, не оригінальний пароль. Timezone використовується для коректного відображення дат у часовому поясі користувача.

### habits

Таблиця звичок користувачів. Кожна звичка прив'язана до одного користувача через user_id. Поле frequency визначає як часто треба виконувати звичку (щодня або певні дні тижня). Поле target_days містить JSON масив днів тижня для weekly звичок (наприклад [1,3,5] для понеділка, середи, п'ятниці). Поле is_active дозволяє архівувати звички без видалення.

### habit_logs

Таблиця записів виконання звичок. Містить інформацію про те, чи була виконана звичка в конкретний день. Поле date зберігає дату виконання, completed - чи була звичка виконана. Поле note дозволяє користувачу додати коментар до виконання. Комбінація habit_id + date має бути унікальною (один запис на день для кожної звички).

### categories

Довідник категорій для звичок. Містить назву категорії, колір для візуалізації в UI (hex формат, наприклад #FF5733) та опціональну іконку. Категорії можуть бути спільними для всіх користувачів або створюватись користувачами (буде визначено пізніше).

## Зв'язки між таблицями

**users → habits** (1:N) - один користувач має багато звичок. При видаленні користувача всі його звички також видаляються (CASCADE).

**habits → habit_logs** (1:N) - одна звичка має багато записів виконання. При видаленні звички всі її записи також видаляються (CASCADE).

**categories → habits** (1:N) - одна категорія може бути у багатьох звичок. При видаленні категорії поле category_id у звичках встановлюється в NULL (SET NULL).

## Індекси

Для оптимізації запитів будуть створені наступні індекси:

```
users:
- PRIMARY KEY (id)
- UNIQUE INDEX (email)

habits:
- PRIMARY KEY (id)
- INDEX (user_id)
- INDEX (category_id)
- INDEX (is_active)

habit_logs:
- PRIMARY KEY (id)
- UNIQUE INDEX (habit_id, date)
- INDEX (date)

categories:
- PRIMARY KEY (id)
- UNIQUE INDEX (name)
```

## Обмеження цілісності

**Foreign Keys** - всі зовнішні ключі мають відповідні обмеження для забезпечення referential integrity.

**NOT NULL** - обов'язкові поля (id, email, password, title тощо) мають обмеження NOT NULL.

**UNIQUE** - унікальні поля (email, комбінація habit_id + date) мають відповідні обмеження.

**CHECK** - додаткові перевірки на рівні БД (наприклад, frequency може бути тільки 'daily' або 'weekly').

## Приклади даних

### User

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "password": "$2b$10$...",
  "name": "Іван Петренко",
  "timezone": "Europe/Kiev",
  "created_at": "2025-11-29T10:00:00Z",
  "updated_at": "2025-11-29T10:00:00Z"
}
```

### Habit

```json
{
  "id": "660e8400-e29b-41d4-a716-446655440001",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "category_id": "770e8400-e29b-41d4-a716-446655440002",
  "title": "Ранкова пробіжка",
  "description": "Біг 5 км в парку",
  "frequency": "weekly",
  "target_days": [1, 3, 5],
  "is_active": true,
  "created_at": "2025-11-29T10:00:00Z",
  "updated_at": "2025-11-29T10:00:00Z"
}
```

### HabitLog

```json
{
  "id": "880e8400-e29b-41d4-a716-446655440003",
  "habit_id": "660e8400-e29b-41d4-a716-446655440001",
  "date": "2025-11-29",
  "completed": true,
  "note": "Пробіг 6 км замість 5",
  "created_at": "2025-11-29T18:30:00Z"
}
```

### Category

```json
{
  "id": "770e8400-e29b-41d4-a716-446655440002",
  "name": "Спорт",
  "color": "#FF5733",
  "icon": "running",
  "created_at": "2025-11-29T10:00:00Z"
}
```
